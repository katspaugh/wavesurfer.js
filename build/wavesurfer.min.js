"use strict";var WaveSurfer={defaultParams:{height:128,waveColor:"#999",progressColor:"#555",cursorColor:"#333",selectionColor:"#0fc",cursorWidth:1,markerWidth:2,skipLength:2,minPxPerSec:10,samples:3,pixelRatio:window.devicePixelRatio,fillParent:!0,scrollParent:!1,normalize:!1,audioContext:null,container:null,renderer:"Canvas",dragSelection:!0,loopSelection:!0,audioRate:1,interact:!0,maxDuration:600},init:function(e){if(this.params=WaveSurfer.util.extend({},this.defaultParams,e),this.container="string"==typeof e.container?document.querySelector(this.params.container):this.params.container,!this.container)throw new Error("wavesurfer.js: container element not found");this.markers={},this.once("marked",this.bindMarks.bind(this)),this.savedVolume=0,this.isMuted=!1,this.loopSelection=this.params.loopSelection,this.minPxPerSec=this.params.minPxPerSec,this.createMedia(),this.createBackend(),this.createDrawer()},createMedia:function(){var e=this;this.media=document.createElement("audio"),this.media.controls=!1,this.media.autoplay=!1,this.media.addEventListener("canplay",function(){e.onCanPlay&&e.onCanPlay()}),this.media.addEventListener("error",function(){e.fireEvent("error","Error loading audio")}),this.container.appendChild(this.media)},createDrawer:function(){var e=this;this.drawer=Object.create(WaveSurfer.Drawer[this.params.renderer]),this.drawer.init(this.container,this.params),this.drawer.on("redraw",function(){e.drawBuffer()}),this.on("progress",function(t){e.drawer.progress(t)}),this.drawer.on("mousedown",function(t){e.seekTo(t)}),this.params.dragSelection&&(this.drawer.on("drag",function(t){e.updateSelection(t)}),this.drawer.on("drag-clear",function(){e.clearSelection()})),this.drawer.on("mouseup",function(t){e.fireEvent("mouseup",t)})},createBackend:function(){var e=this;this.backend=Object.create(WaveSurfer.WebAudio),this.backend.on("play",function(){e.fireEvent("play")}),this.on("play",function(){e.restartAnimationLoop()}),this.backend.on("finish",function(){e.fireEvent("finish")}),this.backend.init(this.params)},restartAnimationLoop:function(){var e=this,t=window.requestAnimationFrame||window.webkitRequestAnimationFrame,i=function(){e.backend.isPaused()||(e.fireEvent("progress",e.backend.getPlayedPercents()),t(i))};i()},getDuration:function(){return this.backend.getDuration()},getCurrentTime:function(){return this.backend.getCurrentTime()},playAt:function(e){this.backend.play(this.getDuration()*e)},play:function(){this.backend.play()},pause:function(){this.backend.pause()},playPause:function(){this.backend.isPaused()?this.play():this.pause()},skipBackward:function(e){this.skip(e||-this.params.skipLength)},skipForward:function(e){this.skip(e||this.params.skipLength)},skip:function(e){var t=this.timings(e),i=t[0]/t[1];this.seekTo(i)},seekTo:function(e){var t=this.backend.isPaused();this.playAt(e),t&&this.pause(),this.fireEvent("seek",e)},stop:function(){this.playAt(0),this.pause(),this.drawer.progress(0)},setVolume:function(e){this.backend.setVolume(e)},toggleMute:function(){this.isMuted?(this.backend.setVolume(this.savedVolume),this.isMuted=!1):(this.savedVolume=this.backend.getVolume(),this.backend.setVolume(0),this.isMuted=!0)},mark:function(e){var t=this,i=WaveSurfer.util.extend({id:WaveSurfer.util.getId(),width:this.params.markerWidth},e);if(i.percentage&&!i.position&&(i.position=i.percentage*this.getDuration()),i.percentage=i.position/this.getDuration(),i.id in this.markers)return this.markers[i.id].update(i);i.position||(i.position=this.getCurrentTime(),i.percentage=i.position/this.getDuration());var r=Object.create(WaveSurfer.Mark);return r.init(i),r.on("update",function(){t.drawer.updateMark(r)}),r.on("remove",function(){t.drawer.removeMark(r),delete t.markers[r.id]}),this.drawer.addMark(r),this.drawer.on("mark-over",function(e,i){e.fireEvent("over",i),t.fireEvent("mark-over",e,i)}),this.drawer.on("mark-leave",function(e,i){e.fireEvent("leave",i),t.fireEvent("mark-leave",e,i)}),this.markers[r.id]=r,this.fireEvent("marked",r),r},redrawMarks:function(){Object.keys(this.markers).forEach(function(e){this.mark(this.markers[e])},this)},clearMarks:function(){Object.keys(this.markers).forEach(function(e){this.markers[e].remove()},this),this.markers={}},timings:function(e){var t=this.getCurrentTime()||0,i=this.getDuration()||1;return t=Math.max(0,Math.min(i,t+(e||0))),[t,i]},drawBuffer:function(){if(this.params.fillParent&&!this.params.scrollParent)var e=this.drawer.getWidth();else e=Math.round(this.getDuration()*this.minPxPerSec*this.params.pixelRatio);this.drawer.drawPeaks(this.backend.getPeaks(e),e),this.drawer.progress(this.backend.getPlayedPercents()),this.redrawMarks(),this.fireEvent("redraw")},drawAsItPlays:function(){var e=this,t=Math.round(this.getDuration()*this.minPxPerSec*this.params.pixelRatio),i=new Uint8Array(t),r=-1;this.params.scrollParent=!0,this.drawer.setWidth(t),this.on("progress",function(){var n=~~(e.backend.getPlayedPercents()*t);n!=r&&(r=n,i[n]=WaveSurfer.util.max(e.backend.waveform(),128)),e.drawer.clearWave(),e.drawer.drawWave(i,128)})},load:function(e){var t=this;this.empty(),this.media.src=e,this.onCanPlay=function(){t.onCanPlay=null,t.media.oncanplay=null,t.backend.loadMedia(t.media),t.media.duration>t.params.maxDuration?(t.drawAsItPlays(),t.fireEvent("ready")):t.loadArrayBuffer(e,function(e){t.backend.decodeArrayBuffer(e,function(){t.drawBuffer(),t.fireEvent("ready")},function(){t.fireEvent("error","Error decoding audiobuffer")})})}},loadArrayBuffer:function(e,t){var i=this,r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.addEventListener("progress",function(e){i.onProgress(e)}),r.addEventListener("load",function(){200==r.status?t(r.response):i.fireEvent("error","Server response: "+r.statusText)}),r.addEventListener("error",function(){i.fireEvent("error","Error loading audio")}),r.send(),i.fireEvent("xhr-start",r)},onProgress:function(e){if(e.lengthComputable)var t=e.loaded/e.total;else t=e.loaded/(e.loaded+1e6);this.fireEvent("loading",Math.round(100*t),e.target)},bindMarks:function(){var e=this,t=0;this.backend.on("play",function(){Object.keys(e.markers).forEach(function(t){e.markers[t].played=!1})}),this.backend.on("audioprocess",function(i){Object.keys(e.markers).forEach(function(r){var n=e.markers[r];n.played||n.position<=i&&n.position>=t&&(n.played=!0,e.fireEvent("mark",n),n.fireEvent("reached"))}),t=i})},empty:function(){this.backend.isPaused()||this.stop(),this.clearMarks(),this.drawer.setWidth(0),this.drawer.drawPeaks({length:this.drawer.getWidth()},0),this.backend.disconnectSource()},destroy:function(){this.fireEvent("destroy"),this.clearMarks(),this.unAll(),this.container.removeChild(this.media),this.backend.destroy(),this.drawer.destroy()},updateSelection:function(e){var t=e.startPercentage,i=e.endPercentage,r=this.params.selectionColor;if(t>i){var n=t;t=i,i=n}this.selMark0?this.selMark0.update({percentage:t}):this.selMark0=this.mark({percentage:t,color:r}),this.selMark1?this.selMark1.update({percentage:i}):this.selMark1=this.mark({percentage:i,color:r}),this.drawer.updateSelection(t,i),this.loopSelection&&this.backend.updateSelection(t,i)},clearSelection:function(){this.selMark0&&(this.selMark0.remove(),this.selMark0=null),this.selMark1&&(this.selMark1.remove(),this.selMark1=null),this.drawer.clearSelection(),this.loopSelection&&this.backend.clearSelection()},toggleLoopSelection:function(){this.loopSelection=!this.loopSelection,this.selMark0&&(this.selectionPercent0=this.selMark0.percentage),this.selMark1&&(this.selectionPercent1=this.selMark1.percentage),this.updateSelection(),this.selectionPercent0=null,this.selectionPercent1=null},getSelection:function(){return this.selMark0&&this.selMark1?{startPercentage:this.selMark0.percentage,startPosition:this.selMark0.position,endPercentage:this.selMark1.percentage,endPosition:this.selMark1.position}:null},enableInteraction:function(){this.drawer.interact=!0},disableInteraction:function(){this.drawer.interact=!1},toggleInteraction:function(){this.drawer.interact=!this.drawer.interact}};WaveSurfer.Mark={defaultParams:{id:null,position:0,percentage:0,width:1,color:"#333"},init:function(e){return this.apply(WaveSurfer.util.extend({},this.defaultParams,e)),this},getTitle:function(){return[~~(this.position/60),("00"+~~(this.position%60)).slice(-2)].join(":")},apply:function(e){Object.keys(e).forEach(function(t){t in this.defaultParams&&(this[t]=e[t])},this)},update:function(e){this.apply(e),this.fireEvent("update")},remove:function(){this.fireEvent("remove")}},WaveSurfer.Observer={on:function(e,t){this.handlers||(this.handlers={});var i=this.handlers[e];i||(i=this.handlers[e]=[]),i.push(t)},un:function(e,t){if(this.handlers){var i=this.handlers[e];if(i)if(t)for(var r=i.length-1;r>=0;r--)i[r]==t&&i.splice(r,1);else i.length=0}},unAll:function(){this.handlers=null},once:function(e,t){var i=function(){t(),this.un(e,i)}.bind(this);this.on(e,i)},fireEvent:function(e){if(this.handlers){var t=this.handlers[e],i=Array.prototype.slice.call(arguments,1);if(t)for(var r=0,n=t.length;n>r;r+=1)t[r].apply(null,i)}}},WaveSurfer.util={extend:function(e){var t=Array.prototype.slice.call(arguments,1);return t.forEach(function(t){null!=t&&Object.keys(t).forEach(function(i){e[i]=t[i]})}),e},getId:function(){return"wavesurfer_"+Math.random().toString(32).substring(2)},max:function(e,t){for(var i=-1/0,r=0,n=e.length;n>r;r++){var a=e[r];null!=t&&(a=Math.abs(a-t)),a>i&&(i=a)}return i}},WaveSurfer.util.extend(WaveSurfer,WaveSurfer.Observer),WaveSurfer.util.extend(WaveSurfer.Mark,WaveSurfer.Observer),WaveSurfer.WebAudio={scriptBufferSize:256,fftSize:128,init:function(e){if(!window.AudioContext&&!window.webkitAudioContext)throw new Error("wavesurfer.js: your browser doesn't support WebAudio");this.params=e,this.ac=e.audioContext||this.getAudioContext(),this.offlineAc=this.getOfflineAudioContext(this.ac.sampleRate),this.loop=!1,this.prevFrameTime=0,this.createVolumeNode(),this.createScriptNode(),this.createAnalyserNode(),this.setPlaybackRate(this.params.audioRate)},setFilter:function(e){this.filterNode&&this.filterNode.disconnect(),this.gainNode.disconnect(),e?(e.connect(this.ac.destination),this.gainNode.connect(e)):this.gainNode.connect(this.ac.destination),this.filterNode=e},createScriptNode:function(){var e=this,t=this.scriptBufferSize;this.scriptNode=this.ac.createScriptProcessor?this.ac.createScriptProcessor(t):this.ac.createJavaScriptNode(t),this.scriptNode.connect(this.ac.destination),this.scriptNode.onaudioprocess=function(){if(!e.isPaused()){var t=e.getCurrentTime();e.onPlayFrame(t),e.fireEvent("audioprocess",t)}}},onPlayFrame:function(e){this.loop&&(this.prevFrameTime>this.loopStart&&this.prevFrameTime<=this.loopEnd&&e>this.loopEnd&&this.play(this.loopStart),this.prevFrameTime=e)},createAnalyserNode:function(){this.analyser=this.ac.createAnalyser(),this.analyser.fftSize=this.fftSize,this.analyserData=new Uint8Array(this.analyser.frequencyBinCount),this.analyser.connect(this.gainNode)},setPlaybackRate:function(e){this.playbackRate=e||1,this.source&&(this.source.mediaElement.playbackRate=this.playbackRate)},createVolumeNode:function(){this.gainNode=this.ac.createGain?this.ac.createGain():this.ac.createGainNode(),this.gainNode.connect(this.ac.destination)},setVolume:function(e){this.gainNode.gain.value=e},getVolume:function(){return this.gainNode.gain.value},loadMedia:function(e){this.source&&this.source.disconnect(),this.source=this.ac.createMediaElementSource(e),this.source.mediaElement.playbackRate=this.playbackRate,this.source.connect(this.analyser)},decodeArrayBuffer:function(e,t,i){var r=this;this.offlineAc.decodeAudioData(e,function(e){r.buffer=e,t()},i)},isPaused:function(){return!this.source||this.source.mediaElement.paused},getDuration:function(){return this.source.mediaElement.duration},play:function(e){null!=e&&(this.source.mediaElement.currentTime=e),this.prevFrameTime=this.getCurrentTime(),this.source.mediaElement.play(),this.fireEvent("play")},pause:function(){this.source.mediaElement.pause(),this.fireEvent("pause")},getPeaks:function(e){for(var t=this.buffer,i=t.length/e,r=~~(i/10)||1,n=t.numberOfChannels,a=new Float32Array(e),s=0;n>s;s++)for(var o=t.getChannelData(s),h=0;e>h;h++){for(var c=~~(h*i),u=~~(c+i),d=0,l=c;u>l;l+=r){var f=o[l];f>d?d=f:-f>d&&(d=-f)}s>0?a[h]+=d:a[h]=d,s==n-1&&(a[h]=a[h]/n)}return a},getPlayedPercents:function(){var e=this.getDuration();return this.getCurrentTime()/e||0},getCurrentTime:function(){return this.source.mediaElement.currentTime},audioContext:null,getAudioContext:function(){return WaveSurfer.WebAudio.audioContext||(WaveSurfer.WebAudio.audioContext=new(window.AudioContext||window.webkitAudioContext)),WaveSurfer.WebAudio.audioContext},offlineAudioContext:null,getOfflineAudioContext:function(e){return WaveSurfer.WebAudio.offlineAudioContext||(WaveSurfer.WebAudio.offlineAudioContext=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,2,e)),WaveSurfer.WebAudio.offlineAudioContext},disconnectSource:function(){this.source&&this.source.disconnect()},destroy:function(){this.pause(),this.unAll(),this.buffer=null,this.filterNode&&this.filterNode.disconnect(),this.gainNode.disconnect(),this.scriptNode.disconnect(),this.analyser.disconnect()},updateSelection:function(e,t){var i=this.getDuration();this.loop=!0,this.loopStart=i*e,this.loopEnd=i*t},clearSelection:function(){this.loop=!1,this.loopStart=0,this.loopEnd=0},waveform:function(){return this.analyser.getByteTimeDomainData(this.analyserData),this.analyserData}},WaveSurfer.util.extend(WaveSurfer.WebAudio,WaveSurfer.Observer),WaveSurfer.Drawer={init:function(e,t){this.container=e,this.params=t,this.pixelRatio=this.params.pixelRatio,this.width=0,this.height=t.height*this.pixelRatio,this.containerWidth=this.container.clientWidth,this.interact=this.params.interact,this.lastPos=0,this.createWrapper(),this.createElements()},createWrapper:function(){this.wrapper=this.container.appendChild(document.createElement("wave")),this.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.params.height+"px"}),(this.params.fillParent||this.params.scrollParent)&&this.style(this.wrapper,{width:"100%",overflowX:this.params.scrollParent?"scroll":"hidden",overflowY:"hidden"}),this.setupWrapperEvents()},setupWrapperEvents:function(){var e=this,t=function(t){t.preventDefault();var i=e.wrapper.getBoundingClientRect();return(t.clientX-i.left+e.wrapper.scrollLeft)/e.scrollWidth||0};this.wrapper.addEventListener("mousedown",function(i){e.interact&&e.fireEvent("mousedown",t(i),i)}),this.wrapper.addEventListener("mousedown",function(t){e.interact&&e.fireEvent("mouseup",t)}),this.params.dragSelection&&function(){var i={},r=function(){i.startPercentage=i.endPercentage=null};document.addEventListener("mouseup",r),e.on("destroy",function(){document.removeEventListener("mouseup",r)}),e.wrapper.addEventListener("mousedown",function(e){e.stopPropagation(),i.startPercentage=t(e)}),e.wrapper.addEventListener("mousemove",function(r){r.stopPropagation(),null!=i.startPercentage&&(i.endPercentage=t(r),e.fireEvent("drag",i))}),e.wrapper.addEventListener("dblclick",function(){e.fireEvent("drag-clear",i)})}()},drawPeaks:function(e,t){if(this.resetScroll(),this.setWidth(t),this.params.normalize)var i=WaveSurfer.util.max(e);else i=1;this.drawWave(e,i)},style:function(e,t){return Object.keys(t).forEach(function(i){e.style[i]!=t[i]&&(e.style[i]=t[i])}),e},resetScroll:function(){this.wrapper.scrollLeft=0},recenter:function(e){var t=this.containerWidth*e;this.recenterOnPosition(t,!0)},recenterOnPosition:function(e,t){var i=this.wrapper.scrollLeft,r=~~(this.containerWidth/2),n=e-r,a=n-i;if(!t&&a>=-r&&r>a){var s=5;a=Math.max(-s,Math.min(s,a)),n=i+a}0!=a&&(this.wrapper.scrollLeft=n)},getWidth:function(){return Math.round(this.containerWidth*this.pixelRatio)},setWidth:function(e){e!=this.width&&(this.width=e,this.scrollWidth=~~(this.width/this.pixelRatio),this.containerWidth=this.container.clientWidth,this.params.fillParent||this.params.scrollParent||this.style(this.wrapper,{width:this.scrollWidth+"px"}),this.updateWidth())},progress:function(e){var t=1/this.pixelRatio,i=Math.round(e*this.width)*t;if(i<this.lastPos||i-this.lastPos>=t){if(this.lastPos=i,this.params.scrollParent){var r=~~(this.scrollWidth*e);this.recenterOnPosition(r)}this.updateProgress(e)}},destroy:function(){this.unAll(),this.container.removeChild(this.wrapper),this.wrapper=null},updateSelection:function(e,t){this.startPercent=e,this.endPercent=t,this.drawSelection()},clearSelection:function(){this.startPercent=null,this.endPercent=null,this.eraseSelection()},createElements:function(){},updateWidth:function(){},drawWave:function(){},clearWave:function(){},updateProgress:function(){},addMark:function(){},removeMark:function(){},updateMark:function(){},drawSelection:function(){},eraseSelection:function(){}},WaveSurfer.util.extend(WaveSurfer.Drawer,WaveSurfer.Observer),WaveSurfer.Drawer.Canvas=Object.create(WaveSurfer.Drawer),WaveSurfer.util.extend(WaveSurfer.Drawer.Canvas,{createElements:function(){var e=this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:1}));this.progressWave=this.wrapper.appendChild(this.style(document.createElement("wave"),{position:"absolute",zIndex:2,overflow:"hidden",width:"0",height:this.params.height+"px",borderRight:[this.params.cursorWidth+"px","solid",this.params.cursorColor].join(" ")}));var t=this.progressWave.appendChild(document.createElement("canvas")),i=this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:0}));this.waveCc=e.getContext("2d"),this.progressCc=t.getContext("2d"),this.selectionCc=i.getContext("2d")},updateWidth:function(){var e=Math.round(this.width/this.pixelRatio)+"px";[this.waveCc,this.progressCc,this.selectionCc].forEach(function(t){t.canvas.width=this.width,t.canvas.height=this.height,this.style(t.canvas,{width:e+"px"})},this),this.clearWave()},clearWave:function(){this.waveCc.clearRect(0,0,this.width,this.height),this.progressCc.clearRect(0,0,this.width,this.height)},drawWave:function(e,t){var i=.5/this.pixelRatio;this.waveCc.fillStyle=this.params.waveColor,this.progressCc.fillStyle=this.params.progressColor;var r=this.height/t,n=this.height/2;this.waveCc.beginPath(),this.waveCc.moveTo(i,n),this.progressCc.beginPath(),this.progressCc.moveTo(i,n);for(var a=0;a<this.width;a++){var s=Math.round(e[a]*r);this.waveCc.lineTo(a+i,n+s),this.progressCc.lineTo(a+i,n+s)}this.waveCc.lineTo(this.width+i,n),this.progressCc.lineTo(this.width+i,n),this.waveCc.moveTo(i,n),this.progressCc.moveTo(i,n);for(var a=0;a<this.width;a++){var s=Math.round(e[a]*r);this.waveCc.lineTo(a+i,n-s),this.progressCc.lineTo(a+i,n-s)}this.waveCc.lineTo(this.width+i,n),this.waveCc.fill(),this.progressCc.lineTo(this.width+i,n),this.progressCc.fill()},updateProgress:function(e){var t=Math.round(this.width*e)/this.pixelRatio;this.style(this.progressWave,{width:t+"px"})},addMark:function(e){var t=document.createElement("mark");t.id=e.id,this.wrapper.appendChild(t);var i=this;t.addEventListener("mouseover",function(t){i.fireEvent("mark-over",e,t)}),t.addEventListener("mouseleave",function(t){i.fireEvent("mark-leave",e,t)}),this.updateMark(e)},updateMark:function(e){var t=document.getElementById(e.id);t.title=e.getTitle(),this.style(t,{height:"100%",position:"absolute",zIndex:3,width:e.width+"px",left:Math.max(0,Math.round(e.percentage*this.width-e.width/2))+"px",backgroundColor:e.color})},removeMark:function(e){var t=document.getElementById(e.id);t&&this.wrapper.removeChild(t)},drawSelection:function(){this.eraseSelection(),this.selectionCc.fillStyle=this.params.selectionColor;var e=this.startPercent*this.width,t=this.endPercent*this.width-e;this.selectionCc.fillRect(e,0,t,this.height)},eraseSelection:function(){this.selectionCc.clearRect(0,0,this.width,this.height)}});
//# sourceMappingURL=/build/wavesurfer-js-map.json