/*! wavesurfer.js 1.4.0 (Wed, 14 Jun 2017 02:39:59 GMT)
* https://github.com/katspaugh/wavesurfer.js
* @license BSD-3-Clause */
!function(e,t){"function"==typeof define&&define.amd?define(["wavesurfer"],function(e){return t(e)}):"object"==typeof module&&module.exports?module.exports=t(require("wavesurfer.js")):t(e.WaveSurfer)}(this,function(e){"use strict";e.ELAN={Types:{ALIGNABLE_ANNOTATION:"ALIGNABLE_ANNOTATION",REF_ANNOTATION:"REF_ANNOTATION"},init:function(e){if(this.data=null,this.params=e,this.container="string"==typeof e.container?document.querySelector(e.container):e.container,!this.container)throw Error("No container for ELAN");this.bindClick(),e.url&&this.load(e.url)},load:function(e){var t=this;this.loadXML(e,function(e){t.data=t.parseElan(e),t.render(),t.fireEvent("ready",t.data)})},loadXML:function(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="document",n.send(),n.addEventListener("load",function(e){t&&t(e.target.responseXML)})},parseElan:function(e){var t=Array.prototype.forEach,n=Array.prototype.map,r={media:{},timeOrder:{},tiers:[],annotations:{},alignableAnnotations:[]},a=e.querySelector("HEADER"),i="milliseconds"==a.getAttribute("TIME_UNITS"),o=a.querySelector("MEDIA_DESCRIPTOR");r.media.url=o.getAttribute("MEDIA_URL"),r.media.type=o.getAttribute("MIME_TYPE");var s=e.querySelectorAll("TIME_ORDER TIME_SLOT"),d={};return t.call(s,function(e){var t=parseFloat(e.getAttribute("TIME_VALUE"));i&&(t=Math.round(100*t)/1e5),d[e.getAttribute("TIME_SLOT_ID")]=t}),r.tiers=n.call(e.querySelectorAll("TIER"),function(e){return{id:e.getAttribute("TIER_ID"),linguisticTypeRef:e.getAttribute("LINGUISTIC_TYPE_REF"),defaultLocale:e.getAttribute("DEFAULT_LOCALE"),annotations:n.call(e.querySelectorAll("REF_ANNOTATION, ALIGNABLE_ANNOTATION"),function(e){var t={type:e.nodeName,id:e.getAttribute("ANNOTATION_ID"),ref:e.getAttribute("ANNOTATION_REF"),value:e.querySelector("ANNOTATION_VALUE").textContent.trim()};return this.Types.ALIGNABLE_ANNOTATION==t.type&&(t.start=d[e.getAttribute("TIME_SLOT_REF1")],t.end=d[e.getAttribute("TIME_SLOT_REF2")],r.alignableAnnotations.push(t)),r.annotations[t.id]=t,t},this)}},this),r.tiers.forEach(function(e){e.annotations.forEach(function(e){null!=e.ref&&(e.reference=r.annotations[e.ref])},this)},this),r.alignableAnnotations.sort(function(e,t){var n=e.start-t.start;return 0==n&&(n=t.end-e.end),n}),r.length=r.alignableAnnotations.length,r},render:function(){var e=this.data.tiers;this.params.tiers&&(e=e.filter(function(e){return e.id in this.params.tiers},this));var t={},n={};e.forEach(function(e,r){e.annotations.forEach(function(e){e.reference&&e.reference.type==this.Types.ALIGNABLE_ANNOTATION&&(e.reference.id in t||(t[e.ref]={}),t[e.ref][r]=e,n[r]=!0)},this)},this),n=Object.keys(n).sort(),this.renderedAlignable=this.data.alignableAnnotations.filter(function(e){return t[e.id]});var r=document.createElement("table");r.className="wavesurfer-annotations";var a=document.createElement("thead"),i=document.createElement("tr");a.appendChild(i),r.appendChild(a);var o=document.createElement("th");o.textContent="Time",o.className="wavesurfer-time",i.appendChild(o),n.forEach(function(t){var n=e[t],r=document.createElement("th");r.className="wavesurfer-tier-"+n.id,r.textContent=n.id,r.style.width=this.params.tiers[n.id],i.appendChild(r)},this);var s=document.createElement("tbody");r.appendChild(s),this.renderedAlignable.forEach(function(r){var a=document.createElement("tr");a.id="wavesurfer-alignable-"+r.id,s.appendChild(a);var i=document.createElement("td");i.className="wavesurfer-time",i.textContent=r.start.toFixed(1)+"â€“"+r.end.toFixed(1),a.appendChild(i);var o=t[r.id];n.forEach(function(t){var n=e[t],i=document.createElement("td"),s=o[t];s&&(i.id="wavesurfer-annotation-"+s.id,i.dataset.ref=r.id,i.dataset.start=r.start,i.dataset.end=r.end,i.textContent=s.value),i.className="wavesurfer-tier-"+n.id,a.appendChild(i)},this)},this),this.container.innerHTML="",this.container.appendChild(r)},bindClick:function(){var e=this;this.container.addEventListener("click",function(t){var n=t.target.dataset.ref;if(null!=n){var r=e.data.annotations[n];r&&e.fireEvent("select",r.start,r.end)}})},getRenderedAnnotation:function(e){var t;return this.renderedAlignable.some(function(n){return n.start<=e&&n.end>=e&&(t=n,!0)}),t},getAnnotationNode:function(e){return document.getElementById("wavesurfer-alignable-"+e.id)}},e.util.extend(e.ELAN,e.Observer)});