/*! wavesurfer.js 1.4.0 (Mon, 10 Apr 2017 08:55:36 GMT)
* https://github.com/katspaugh/wavesurfer.js
* @license BSD-3-Clause */!function(a,b){"function"==typeof define&&define.amd?define(["wavesurfer"],function(a){return b(a)}):"object"==typeof exports?module.exports=b(require("wavesurfer.js")):b(WaveSurfer)}(this,function(a){"use strict";a.ELANWaveSegment={defaultParams:{waveSegmentWidth:200,waveSegmentPeaksPerSegment:200,waveSegmentHeight:30,waveSegmentRenderer:"Canvas",waveSegmentNormalizeTo:"whole",waveSegmentBarHeight:1,waveSegmentBorderWidth:1,pixelRatio:window.devicePixelRatio||screen.deviceXDPI/screen.logicalXDPI},ELAN:null,wavesurfer:null,waveSegments:[],maxPeak:0,init:function(b){switch(this.params=a.util.extend(this.defaultParams,b),this.ELAN=b.ELAN,this.wavesurfer=b.wavesurfer,this.waveSegments=[],this.maxPeak=0,this.params.waveSegmentNormalizeTo){case"segment":this.params.normalize=!0;break;case"whole":this.calculateMaxPeak(),this.params.noramlize=!1;break;default:this.params.normalize=!1}this.addSegmentColumn()},calculateMaxPeak:function(){var b=this.ELAN.renderedAlignable.length*this.params.waveSegmentWidth,c=this.wavesurfer.backend.getPeaks(b,0,b),d=a.util.max(c),e=a.util.min(c);this.maxPeak=-e>d?-e:d},addSegmentColumn:function(){var a=this.ELAN.container.getElementsByTagName("tr"),b=document.createElement("th");b.textContent="Wave",b.className="wavesurfer-wave",b.setAttribute("style","width: "+this.params.waveSegmentWidth+"px"),a[0].insertBefore(b,a[0].firstChild.nextSibling);for(var c=0;c<this.ELAN.renderedAlignable.length;c++){var d=this.ELAN.getAnnotationNode(this.ELAN.renderedAlignable[c]),e=document.createElement("td");e.className="wavesurfer-wave",this.appendWaveSegmentToElement(e,c),d.insertBefore(e,d.firstChild.nextSibling)}},getPeaksForTimeSegment:function(a,b){var c=this.wavesurfer.backend.getDuration(),d=b-a,e=c*this.params.waveSegmentPeaksPerSegment/d,f=c/e,g=~~(a/f),h=~~(b/f),i=this.wavesurfer.backend.getPeaks(e,g,h),j=[];for(var k in i)"whole"==this.params.waveSegmentNormalizeTo?j.push(i[k]/this.maxPeak):j.push(i[k]);return j},appendWaveSegmentToElement:function(b,c){var d=this.ELAN.renderedAlignable[c],e=document.createElement("div"),f=this.params.waveSegmentWidth;e.style.width=(f+2*this.params.waveSegmentBorderWidth).toString()+"px",e.style.height=this.params.waveSegmentHeight.toString()+"px",e.className="elan-wavesegment-container",b.appendChild(e);var g=this.getPeaksForTimeSegment(d.start,d.end),h=this.params;h.fillParent=!0,h.height=this.params.waveSegmentHeight,h.barHeight=this.params.waveSegmentBarHeight,h.plotTimeStart=d.start,h.plotTimeEnd=d.end,h.fillParent=!0,h.scrollParent=!1,this.waveSegments[c]=Object.create(a.Drawer[this.params.waveSegmentRenderer]),this.waveSegments[c].init(e,h),this.waveSegments[c].drawPeaks(g,this.params.waveSegmentWidth*this.params.pixelRatio,0,this.params.waveSegmentPeaksPerSegment),this.waveSegments[c].updateProgress(0)},onProgress:function(a){for(var b=0;b<this.waveSegments.length;b++){var c,d=this.ELAN.renderedAlignable[b].start,e=this.ELAN.renderedAlignable[b].end;if(d>a)c=0;else if(e<a)c=this.params.waveSegmentWidth;else{var f=(a-d)/(e-d);c=f*this.params.waveSegmentWidth}this.waveSegments[b].updateProgress(c)}}},a.util.extend(a.ELANWaveSegment,a.Observer)});