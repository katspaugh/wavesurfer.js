/*! wavesurfer.js 1.4.0 (Wed, 14 Jun 2017 02:39:59 GMT)
* https://github.com/katspaugh/wavesurfer.js
* @license BSD-3-Clause */
!function(e,t){"function"==typeof define&&define.amd?define(["wavesurfer"],function(e){return t(e)}):"object"==typeof module&&module.exports?module.exports=t(require("wavesurfer.js")):t(e.WaveSurfer)}(this,function(e){"use strict";e.ELANWaveSegment={defaultParams:{waveSegmentWidth:200,waveSegmentPeaksPerSegment:200,waveSegmentHeight:30,waveSegmentRenderer:"Canvas",waveSegmentNormalizeTo:"whole",waveSegmentBarHeight:1,waveSegmentBorderWidth:1,pixelRatio:window.devicePixelRatio||screen.deviceXDPI/screen.logicalXDPI},ELAN:null,wavesurfer:null,waveSegments:[],maxPeak:0,init:function(t){switch(this.params=e.util.extend(this.defaultParams,t),this.ELAN=t.ELAN,this.wavesurfer=t.wavesurfer,this.waveSegments=[],this.maxPeak=0,this.params.waveSegmentNormalizeTo){case"segment":this.params.normalize=!0;break;case"whole":this.calculateMaxPeak(),this.params.noramlize=!1;break;default:this.params.normalize=!1}this.addSegmentColumn()},calculateMaxPeak:function(){var t=this.ELAN.renderedAlignable.length*this.params.waveSegmentWidth,a=this.wavesurfer.backend.getPeaks(t,0,t),n=e.util.max(a),i=e.util.min(a);this.maxPeak=-i>n?-i:n},addSegmentColumn:function(){var e=this.ELAN.container.getElementsByTagName("tr"),t=document.createElement("th");t.textContent="Wave",t.className="wavesurfer-wave",t.setAttribute("style","width: "+this.params.waveSegmentWidth+"px"),e[0].insertBefore(t,e[0].firstChild.nextSibling);for(var a=0;a<this.ELAN.renderedAlignable.length;a++){var n=this.ELAN.getAnnotationNode(this.ELAN.renderedAlignable[a]),i=document.createElement("td");i.className="wavesurfer-wave",this.appendWaveSegmentToElement(i,a),n.insertBefore(i,n.firstChild.nextSibling)}},getPeaksForTimeSegment:function(e,t){var a=this.wavesurfer.backend.getDuration(),n=t-e,i=a*this.params.waveSegmentPeaksPerSegment/n,r=a/i,s=~~(e/r),m=~~(t/r),h=this.wavesurfer.backend.getPeaks(i,s,m),g=[];for(var l in h)"whole"==this.params.waveSegmentNormalizeTo?g.push(h[l]/this.maxPeak):g.push(h[l]);return g},appendWaveSegmentToElement:function(t,a){var n=this.ELAN.renderedAlignable[a],i=document.createElement("div"),r=this.params.waveSegmentWidth;i.style.width=(r+2*this.params.waveSegmentBorderWidth).toString()+"px",i.style.height=this.params.waveSegmentHeight.toString()+"px",i.className="elan-wavesegment-container",t.appendChild(i);var s=this.getPeaksForTimeSegment(n.start,n.end),m=this.params;m.fillParent=!0,m.height=this.params.waveSegmentHeight,m.barHeight=this.params.waveSegmentBarHeight,m.plotTimeStart=n.start,m.plotTimeEnd=n.end,m.fillParent=!0,m.scrollParent=!1,this.waveSegments[a]=Object.create(e.Drawer[this.params.waveSegmentRenderer]),this.waveSegments[a].init(i,m),this.waveSegments[a].drawPeaks(s,this.params.waveSegmentWidth*this.params.pixelRatio,0,this.params.waveSegmentPeaksPerSegment),this.waveSegments[a].updateProgress(0)},onProgress:function(e){for(var t=0;t<this.waveSegments.length;t++){var a,n=this.ELAN.renderedAlignable[t].start,i=this.ELAN.renderedAlignable[t].end;a=n>e?0:i<e?this.params.waveSegmentWidth:(e-n)/(i-n)*this.params.waveSegmentWidth,this.waveSegments[t].updateProgress(a)}}},e.util.extend(e.ELANWaveSegment,e.Observer)});