/*! wavesurfer.js 1.4.0 (Wed, 14 Jun 2017 02:39:59 GMT)
* https://github.com/katspaugh/wavesurfer.js
* @license BSD-3-Clause */
!function(e,i){"function"==typeof define&&define.amd?define(["wavesurfer"],function(e){return i(e)}):"object"==typeof module&&module.exports?module.exports=i(require("wavesurfer.js")):i(e.WaveSurfer)}(this,function(e){"use strict";e.Minimap=e.util.extend({},e.Drawer,e.Drawer.Canvas,{init:function(i,r){this.wavesurfer=i,this.container=this.wavesurfer.drawer.container,this.lastPos=this.wavesurfer.drawer.lastPos,this.params=i.util.extend({},this.wavesurfer.drawer.params,{showRegions:!1,showOverview:!1,overviewBorderColor:"green",overviewBorderSize:2},r,{scrollParent:!1,fillParent:!0}),this.width=0,this.height=this.params.height*this.params.pixelRatio,this.createWrapper(),this.createElements(),e.Regions&&this.params.showRegions&&this.regions(),this.bindWaveSurferEvents(),this.bindMinimapEvents()},regions:function(){var e=this;this.regions={},this.wavesurfer.on("region-created",function(i){e.regions[i.id]=i,e.renderRegions()}),this.wavesurfer.on("region-updated",function(i){e.regions[i.id]=i,e.renderRegions()}),this.wavesurfer.on("region-removed",function(i){delete e.regions[i.id],e.renderRegions()})},renderRegions:function(){for(var e=this,i=this.wrapper.querySelectorAll("region"),r=0;r<i.length;++r)this.wrapper.removeChild(i[r]);Object.keys(this.regions).forEach(function(i){var r=e.regions[i],t=e.width*((r.end-r.start)/e.wavesurfer.getDuration()),s=e.width*(r.start/e.wavesurfer.getDuration()),n=e.style(document.createElement("region"),{height:"inherit",backgroundColor:r.color,width:t+"px",left:s+"px",display:"block",position:"absolute"});n.classList.add(i),e.wrapper.appendChild(n)})},createElements:function(){e.Drawer.Canvas.createElements.call(this),this.params.showOverview&&(this.overviewRegion=this.style(document.createElement("overview"),{height:this.wrapper.offsetHeight-2*this.params.overviewBorderSize+"px",width:"0px",display:"block",position:"absolute",cursor:"move",border:this.params.overviewBorderSize+"px solid "+this.params.overviewBorderColor,zIndex:2,opacity:this.params.overviewOpacity}),this.wrapper.appendChild(this.overviewRegion))},bindWaveSurferEvents:function(){var e=this;this.render(),this.wavesurfer.on("audioprocess",function(i){e.progress(e.wavesurfer.backend.getPlayedPercents())}),this.wavesurfer.on("seek",function(i){e.progress(e.wavesurfer.backend.getPlayedPercents())}),this.params.showOverview&&(this.wavesurfer.on("scroll",function(i){e.draggingOverview||e.moveOverviewRegion(i.target.scrollLeft/e.ratio)}),this.wavesurfer.drawer.wrapper.addEventListener("mouseover",function(i){e.draggingOverview&&(e.draggingOverview=!1)}));var i=0,r=this.wavesurfer.util.debounce(function(){i!=e.wrapper.clientWidth&&(i=e.wrapper.clientWidth,e.render(),e.progress(e.wavesurfer.backend.getPlayedPercents()))},100);window.addEventListener("resize",r,!0),window.addEventListener("orientationchange",r,!0),this.wavesurfer.on("destroy",function(){e.destroy.bind(this),window.removeEventListener("resize",r,!0)})},bindMinimapEvents:function(){var e=this,i=0,r=!0,t={clientX:0,clientY:0};this.on("click",function(e,i){r?(this.progress(i),this.wavesurfer.seekAndCenter(i)):r=!0}.bind(this)),this.params.showOverview&&(this.overviewRegion.addEventListener("mousedown",function(r){e.draggingOverview=!0,i=r.layerX,t.clientX=r.clientX,t.clientY=r.clientY}),this.wrapper.addEventListener("mousemove",function(r){e.draggingOverview&&e.moveOverviewRegion(r.clientX-e.container.getBoundingClientRect().left-i)}),this.wrapper.addEventListener("mouseup",function(i){t.clientX-i.clientX==0&&t.clientX-i.clientX==0?(r=!0,e.draggingOverview=!1):e.draggingOverview&&(r=!1,e.draggingOverview=!1)}))},render:function(){var e=this.getWidth(),i=this.wavesurfer.backend.getPeaks(e,0,e);this.drawPeaks(i,e,0,e),this.params.showOverview&&(this.ratio=this.wavesurfer.drawer.width/this.width,this.waveShowedWidth=this.wavesurfer.drawer.width/this.ratio,this.waveWidth=this.wavesurfer.drawer.width,this.overviewWidth=this.width/this.ratio,this.overviewPosition=0,this.overviewRegion.style.width=this.overviewWidth-2*this.params.overviewBorderSize+"px")},moveOverviewRegion:function(e){e<0?this.overviewPosition=0:e+this.overviewWidth<this.width?this.overviewPosition=e:this.overviewPosition=this.width-this.overviewWidth,this.overviewRegion.style.left=this.overviewPosition+"px",this.wavesurfer.drawer.wrapper.scrollLeft=this.overviewPosition*this.ratio}}),e.initMinimap=function(i){var r=Object.create(e.Minimap);return r.init(this,i),r}});