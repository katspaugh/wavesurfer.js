/*! wavesurfer.js 1.4.0 (Wed, 14 Jun 2017 02:39:59 GMT)
* https://github.com/katspaugh/wavesurfer.js
* @license BSD-3-Clause */
!function(t,e){"function"==typeof define&&define.amd?define(["wavesurfer"],function(t){return e(t)}):"object"==typeof module&&module.exports?module.exports=e(require("wavesurfer.js")):e(t.WaveSurfer)}(this,function(t){"use strict";t.Timeline={init:function(t){this.params=t;var e=this.wavesurfer=t.wavesurfer;if(!this.wavesurfer)throw Error("No WaveSurfer instance provided");var i=this.drawer=this.wavesurfer.drawer;if(this.container="string"==typeof t.container?document.querySelector(t.container):t.container,!this.container)throw Error("No container for WaveSurfer timeline");this.width=i.width,this.pixelRatio=this.drawer.params.pixelRatio,this.maxCanvasWidth=i.maxCanvasWidth||this.width,this.maxCanvasElementWidth=i.maxCanvasElementWidth||Math.round(this.maxCanvasWidth/this.pixelRatio),this.height=this.params.height||20,this.notchPercentHeight=this.params.notchPercentHeight||90,this.primaryColor=this.params.primaryColor||"#000",this.secondaryColor=this.params.secondaryColor||"#c0c0c0",this.primaryFontColor=this.params.primaryFontColor||"#000",this.secondaryFontColor=this.params.secondaryFontColor||"#000",this.fontFamily=this.params.fontFamily||"Arial",this.fontSize=this.params.fontSize||10,this.timeInterval=this.params.timeInterval,this.primaryLabelInterval=this.params.primaryLabelInterval,this.secondaryLabelInterval=this.params.secondaryLabelInterval,this.formatTimeCallback=this.params.formatTimeCallback,this.canvases=[],this.createWrapper(),this.render(),i.wrapper.addEventListener("scroll",function(t){this.updateScroll(t)}.bind(this)),this._onRedraw=e.on("redraw",this.render.bind(this)),this._onZoom=e.on("zoom",this.render.bind(this)),this._onDestroy=e.on("destroy",this.destroy.bind(this))},destroy:function(){this._onRedraw.un(),this._onZoom.un(),this._onDestroy.un(),this.unAll(),this.wrapper&&this.wrapper.parentNode&&(this.wrapper.parentNode.removeChild(this.wrapper),this.wrapper=null)},createWrapper:function(){var t=this.container.querySelector("timeline");t&&this.container.removeChild(t);var e=this.wavesurfer.params;this.wrapper=this.container.appendChild(document.createElement("timeline")),this.drawer.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.height+"px"}),(e.fillParent||e.scrollParent)&&this.drawer.style(this.wrapper,{width:"100%",overflowX:"hidden",overflowY:"hidden"});var i=this;this.wrapper.addEventListener("click",function(t){t.preventDefault();var e="offsetX"in t?t.offsetX:t.layerX;i.fireEvent("click",e/i.wrapper.scrollWidth||0)})},removeOldCanvases:function(){for(;this.canvases.length>0;){var t=this.canvases.pop();t.parentElement.removeChild(t)}},createCanvases:function(){this.removeOldCanvases();for(var t,e=Math.round(this.drawer.wrapper.scrollWidth),i=Math.ceil(e/this.maxCanvasElementWidth),a=0;a<i;a++)t=this.wrapper.appendChild(document.createElement("canvas")),this.canvases.push(t),this.drawer.style(t,{position:"absolute",zIndex:4})},render:function(){this.createCanvases(),this.updateCanvasStyle(),this.drawTimeCanvases()},updateCanvasStyle:function(){for(var t=this.canvases.length,e=0;e<t;e++){var i=this.canvases[e],a=this.maxCanvasElementWidth;e===t-1&&(a=this.drawer.wrapper.scrollWidth-this.maxCanvasElementWidth*(t-1)),i.width=a*this.pixelRatio,i.height=this.height*this.pixelRatio,i.style.width=a+"px",i.style.height=this.height+"px",i.style.left=e*this.maxCanvasElementWidth+"px"}},drawTimeCanvases:function(){var t=this.wavesurfer.backend,e=this.wavesurfer.params,i=t.getDuration(),a=this;if(e.fillParent&&!e.scrollParent)var r=this.drawer.getWidth();else r=this.drawer.wrapper.scrollWidth*e.pixelRatio;var s=r/i;if(!(i<=0)){var n=0,h=0,o=parseInt(i,10)+1,l=function(t){if("function"==typeof a.formatTimeCallback)return a.formatTimeCallback(t);if(t/60>1){var e=parseInt(t/60);return t=(t=parseInt(t%60))<10?"0"+t:t,e+":"+t}return Math.round(1e3*t)/1e3};if(1*s>=25)var c=1,d=10,p=5;else if(5*s>=25)var c=5,d=6,p=2;else if(15*s>=25)var c=15,d=4,p=2;else var c=60*Math.ceil(.5/s),d=4,p=2;c=this.timeInterval||c,d=this.primaryLabelInterval||d,p=this.secondaryLabelInterval||p;for(var v=this.height-4,f=this.height*(this.notchPercentHeight/100)-4,m=this.fontSize*e.pixelRatio,u=0;u<o/c;u++)u%d==0?(this.setFillStyles(this.primaryColor),this.fillRect(n,0,1,v),this.setFonts(m+"px "+this.fontFamily),this.setFillStyles(this.primaryFontColor),this.fillText(l(h),n+5,v)):u%p==0?(this.setFillStyles(this.secondaryColor),this.fillRect(n,0,1,v),this.setFonts(m+"px "+this.fontFamily),this.setFillStyles(this.secondaryFontColor),this.fillText(l(h),n+5,v)):(this.setFillStyles(this.secondaryColor),this.fillRect(n,0,1,f)),h+=c,n+=s*c}},setFillStyles:function(t){for(var e=0;e<this.canvases.length;e++)this.canvases[e].getContext("2d").fillStyle=t},setFonts:function(t){for(var e=0;e<this.canvases.length;e++)this.canvases[e].getContext("2d").font=t},fillRect:function(t,e,i,a){for(var r=0;r<this.canvases.length;r++){var s=this.canvases[r],n=r*this.maxCanvasWidth,h={x1:Math.max(t,r*this.maxCanvasWidth),y1:e,x2:Math.min(t+i,r*this.maxCanvasWidth+s.width),y2:e+a};h.x1<h.x2&&s.getContext("2d").fillRect(h.x1-n,h.y1,h.x2-h.x1,h.y2-h.y1)}},fillText:function(t,e,i){for(var a,r=0,s=0;s<this.canvases.length;s++){var n=this.canvases[s].getContext("2d"),h=n.canvas.width;if(r>e+a)break;r+h>e&&(a=n.measureText(t).width,n.fillText(t,e-r,i)),r+=h}},updateScroll:function(){this.wrapper.scrollLeft=this.drawer.wrapper.scrollLeft}},t.util.extend(t.Timeline,t.Observer)});